# KaTrain Galaxy ç›´æ’­åŠŸèƒ½è®¾è®¡æ–‡æ¡£

**æ—¥æœŸ**: 2026-01-22
**çŠ¶æ€**: å·²ç¡®è®¤ï¼Œå¾…å®ç°

---

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 åŠŸèƒ½ç›®æ ‡

ä¸º KaTrain Galaxy Web UI æ·»åŠ ç›´æ’­åŠŸèƒ½æ¨¡å—ï¼Œæ”¯æŒï¼š
- å®æ—¶è§‚çœ‹èŒä¸šå›´æ£‹æ¯”èµ›ï¼ˆæ•°æ®æºï¼šXingZhen æ˜Ÿé˜µå›´æ£‹ï¼‰
- å›é¡¾è¿‘æœŸé‡è¦æ¯”èµ›æ£‹è°±ï¼ˆæ•°æ®æºï¼šä¸­å›½å›´æ£‹åä¼šï¼‰
- æœ¬åœ° KataGo å¼•æ“å®æ—¶åˆ†æï¼Œæ ‡æ³¨å¦™æ‰‹/é—®é¢˜æ‰‹
- æŸ¥çœ‹å³å°†è¿›è¡Œçš„èµ›äº‹é¢„å‘Š

### 1.2 æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| åŒæ•°æ®æº | XingZhenï¼ˆå®æ—¶ç›´æ’­ï¼‰+ weiqi.org.cnï¼ˆè¿‘æœŸæ£‹è°±ï¼‰ |
| æœ¬åœ°åˆ†æ | ä½¿ç”¨ KaTrain KataGo å¼•æ“ï¼Œä¸ä¾èµ–ç¬¬ä¸‰æ–¹åˆ†æ |
| PV æ¨æ¼” | æ‚¬åœæ˜¾ç¤º AI é¢„æµ‹å˜åŒ–å›¾ï¼ˆå¯é…ç½®æ­¥æ•°/é€Ÿåº¦ï¼‰ |
| å¦™æ‰‹/é—®é¢˜æ‰‹ | åŸºäºç›®æ•°å˜åŒ–è‡ªåŠ¨æ ‡æ³¨ï¼Œæ‚¬åœæ˜¾ç¤ºåŸå›  |
| èµ›äº‹é¢„å‘Š | å®šæœŸçˆ¬å–æ•´åˆå¤šæ¥æºèµ›äº‹ä¿¡æ¯ |
| è¯„è®ºç³»ç»Ÿ | ç›´æ’­æ—¶æ˜¾ç¤ºè¯„è®ºåŒºï¼Œç”¨æˆ·å¯ç™»å½•å‘è¨€ |

### 1.3 ä¸åŒ…å«ï¼ˆMVP èŒƒå›´å¤–ï¼‰

- æ£‹å‹èµ›äº‹/ä¸šä½™æ¯”èµ›
- è¯„è®ºå®¡æ ¸åŠŸèƒ½ï¼ˆåç»­å®ç°ï¼‰
- æ£‹æ‰‹å¤´åƒè·å–
- å‘æŒ¥æ°´å‡†æŒ‡æ ‡
- åœä¸€æ‰‹ã€ç ”ç©¶ã€åˆ†äº«åŠŸèƒ½

---

## 2. æ•°æ®æº API

### 2.1 XingZhen æ˜Ÿé˜µå›´æ£‹

**åŸºç¡€ URL**: `https://api.19x19.com/api/engine/golives`

| ç«¯ç‚¹ | è¯´æ˜ |
|------|------|
| `GET /all` | æ‰€æœ‰æ­£åœ¨ç›´æ’­çš„æ¯”èµ› |
| `GET /count` | ç›´æ’­æ¯”èµ›æ•°é‡ |
| `GET /history?page=0&size=10&live_type=TOP_LIVE` | å†å²ç›´æ’­åˆ—è¡¨ |
| `GET /situation/{live_id}?no_cache=1` | å½“å‰å±€é¢ + ç€æ³• |
| `GET /winrates/{live_id}?begin_move_num=X` | èƒœç‡å†å² |
| `GET /base/{live_id}?begin_move_num=X&end_move_num=Y` | è¯¦ç»†åˆ†æ |

**å…³é”®æ•°æ®å­—æ®µ**:
- `liveId`: æ¯”èµ›å”¯ä¸€ID
- `liveStatus`: 0=ç›´æ’­ä¸­, 40=å·²ç»“æŸ
- `pb/pw`: é»‘æ–¹/ç™½æ–¹æ£‹æ‰‹å
- `moveNum`: å½“å‰æ‰‹æ•°
- `winrate`: é»‘æ–¹èƒœç‡ (0-1)

### 2.2 ä¸­å›½å›´æ£‹åä¼š

**åŸºç¡€ URL**: `https://wqapi.cwql.org.cn`

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/playerInfo/battle/list` | POST | è·å–å¯¹å±€åˆ—è¡¨ |
| `/playerInfo/battle/{battleNo}` | GET | è·å–å¯¹å±€è¯¦æƒ… + SGF |

**è¯·æ±‚ç¤ºä¾‹**:
```json
POST /playerInfo/battle/list
{
  "pageNum": 1,
  "pageSize": 20,
  "gameKifu": 1
}
```

**å“åº”å…³é”®å­—æ®µ**:
- `battleNo`: å¯¹å±€ID
- `gameKifuSgf`: å®Œæ•´ SGF æ•°æ®
- `gameFullName`: èµ›äº‹å…¨ç§°
- `battleResultComment`: æ¯”èµ›ç»“æœ

---

## 3. é¡µé¢ç»“æ„

### 3.1 ä¸€çº§é¡µé¢ï¼šç›´æ’­é¦–é¡µ (`/galaxy/live`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sidebar   â”‚            ä¸»å†…å®¹åŒº              â”‚      å³è¾¹æ        â”‚
â”‚            â”‚                                 â”‚                  â”‚
â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  [é¡¶å°–å¤§èµ›][é¢„å‘Š]  â”‚
â”‚            â”‚  â”‚                           â”‚  â”‚                  â”‚
â”‚            â”‚  â”‚         æ£‹ ç›˜              â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚            â”‚  â”‚   (æœ€é‡è¦çš„å®æ—¶/æœ€æ–°æ¯”èµ›)    â”‚  â”‚  â”‚ æ­£åœ¨ç›´æ’­    â”‚  â”‚
â”‚            â”‚  â”‚                           â”‚  â”‚  â”‚ äº•å±± vs ä½™  â”‚  â”‚
â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ 91.9% 130æ‰‹ â”‚  â”‚
â”‚            â”‚                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚            â”‚  â”‚  â® âª â¯ â© â­  313/313æ‰‹   â”‚  â”‚  â”‚ å†å²ç›´æ’­    â”‚  â”‚
â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ ä¸Šé‡ vs ... â”‚  â”‚
â”‚            â”‚                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚        [ è¿›å…¥ç›´æ’­ ] æŒ‰é’®         â”‚       ...        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å³è¾¹æ  TAB**:
- **é¡¶å°–å¤§èµ›**ï¼ˆé»˜è®¤ï¼‰ï¼šå®æ—¶ + è¿‘æœŸæ¯”èµ›å¡ç‰‡åˆ—è¡¨ï¼ŒæŒ‰æ—¶é—´å€’åº
- **èµ›äº‹é¢„å‘Š**ï¼šå³å°†è¿›è¡Œçš„é‡è¦æ¯”èµ›åˆ—è¡¨

**ä¸»å†…å®¹åŒºé€»è¾‘**:
- æœ‰å®æ—¶ç›´æ’­ â†’ æ˜¾ç¤ºæœ€é‡è¦çš„å®æ—¶æ¯”èµ›
- æ— å®æ—¶ç›´æ’­ â†’ æ˜¾ç¤ºæœ€æ–°ä¸€åœºå·²ç»“æŸæ¯”èµ›

### 3.2 äºŒçº§é¡µé¢ï¼šå¯¹å±€è¯¦æƒ…é¡µ (`/galaxy/live/{match_id}`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sidebar   â”‚      ä¸»å†…å®¹åŒº       â”‚           å³è¾¹æ  (åŠ å®½)         â”‚
â”‚            â”‚                    â”‚                                â”‚
â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚            â”‚  â”‚              â”‚  â”‚  â”‚ ç¬¬29æœŸæ—¥æœ¬å¥³æµæ£‹åœ£æˆ˜...     â”‚â”‚
â”‚            â”‚  â”‚              â”‚  â”‚  â”‚ ä¸Šé‡æ¢¨çº± â—â”â”â”â”â” 96.2% ä¸Šé‡çˆ±â”‚â”‚
â”‚            â”‚  â”‚              â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚            â”‚  â”‚              â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚            â”‚  â”‚     æ£‹ ç›˜     â”‚  â”‚  â”‚ æ¨èç€æ³•         [â–²][â–¼]   â”‚â”‚
â”‚            â”‚  â”‚              â”‚  â”‚  â”‚ H3  29%  4.7ç›®  96.2%     â”‚â”‚
â”‚            â”‚  â”‚              â”‚  â”‚  â”‚ S7  17%  5.7ç›®  95.8%     â”‚â”‚
â”‚            â”‚  â”‚              â”‚  â”‚  â”‚ G9  16%  4.4ç›®  96.6%     â”‚â”‚
â”‚            â”‚  â”‚              â”‚  â”‚  â”‚ P18 15%  4.5ç›®  96.2%     â”‚â”‚
â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚            â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚            â”‚                    â”‚  â”‚[èµ°åŠ¿å›¾][å¦™æ‰‹][é—®é¢˜æ‰‹]        â”‚â”‚
â”‚            â”‚                    â”‚  â”‚   ğŸ“ˆ èƒœç‡/ç›®æ•°æ›²çº¿          â”‚â”‚
â”‚            â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚            â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚            â”‚                    â”‚  â”‚ è¯•ä¸‹  é¢†åœ°  æ‰‹æ•°            â”‚â”‚
â”‚            â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚            â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚            â”‚                    â”‚  â”‚ ğŸ’¬ è¯„è®ºåŒº (ä»…ç›´æ’­æ—¶æ˜¾ç¤º)     â”‚â”‚
â”‚            â”‚                    â”‚  â”‚  user1: è¿™æ‰‹æ£‹å‰å®³         â”‚â”‚
â”‚            â”‚                    â”‚  â”‚  user2: é»‘æ£‹å½¢åŠ¿ä¸å¦™       â”‚â”‚
â”‚            â”‚                    â”‚  â”‚  [è¾“å…¥è¯„è®º...]    [å‘é€]   â”‚â”‚
â”‚            â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚            â”‚                    â”‚  â® âª â¯ â© â­  297/313æ‰‹       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å³è¾¹æ æ¨¡å—ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰**:
1. **å¯¹å±€ä¿¡æ¯**ï¼šèµ›äº‹åç§°ã€æ—¥æœŸã€æ£‹æ‰‹ä¿¡æ¯ã€èƒœç‡æ¡
2. **AI æ¨èç€æ³•**ï¼šæœ€å¤šæ˜¾ç¤º 4 æ‰‹ï¼Œå¸¦æ»‘åŠ¨æ¡å¯æŸ¥çœ‹æ›´å¤š
3. **èµ°åŠ¿å›¾ TAB**ï¼šèµ°åŠ¿å›¾ / å¦™æ‰‹åˆ—è¡¨ / é—®é¢˜æ‰‹åˆ—è¡¨
4. **åŠŸèƒ½æŒ‰é’®**ï¼šè¯•ä¸‹ã€é¢†åœ°ã€æ‰‹æ•°
5. **è¯„è®ºåŒº**ï¼šä»…ç›´æ’­æ¯”èµ›æ˜¾ç¤ºï¼Œå›ºå®šåŒºåŸŸï¼Œå¯å‘è¨€
6. **æ’­æ”¾æ§åˆ¶æ **ï¼šè¿›åº¦æ§åˆ¶ + æ‰‹æ•°æ˜¾ç¤º

---

## 4. åç«¯æ¶æ„

### 4.1 æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           KaTrain åç«¯                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ LivePoller  â”‚    â”‚ LiveCache   â”‚    â”‚     KataGo Engine       â”‚ â”‚
â”‚  â”‚ (å®šæ—¶ä»»åŠ¡)   â”‚â”€â”€â”€â–¶â”‚ (Redis/å†…å­˜) â”‚â”€â”€â”€â–¶â”‚     (æœ¬åœ°åˆ†æ)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                  â”‚                       â”‚               â”‚
â”‚         â–¼                  â–¼                       â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ XingZhen    â”‚    â”‚ weiqi.org   â”‚    â”‚   åˆ†æç»“æœå­˜å‚¨           â”‚ â”‚
â”‚  â”‚ API Client  â”‚    â”‚ API Client  â”‚    â”‚   (SGF + åˆ†ææ•°æ®)       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚                       â”‚
         â–¼                   â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ api.19x19.com   â”‚  â”‚ wqapi.cwql.org  â”‚  â”‚    PostgreSQL DB        â”‚
â”‚ (ç€æ³•/èµ›äº‹ä¿¡æ¯)  â”‚  â”‚ (æ£‹è°±/SGF)      â”‚  â”‚ (ç”¨æˆ·/è¯„è®º/å†å²åˆ†æ)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 åç«¯æ¨¡å—ç»“æ„

```
katrain/web/
â”œâ”€â”€ live/                       # æ–°å¢ï¼šç›´æ’­æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ poller.py              # å®šæ—¶è½®è¯¢ä»»åŠ¡
â”‚   â”œâ”€â”€ cache.py               # ç›´æ’­æ•°æ®ç¼“å­˜
â”‚   â”œâ”€â”€ clients/
â”‚   â”‚   â”œâ”€â”€ xingzhen.py        # XingZhen API å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ weiqi_org.py       # weiqi.org.cn API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ analyzer.py            # KataGo åˆ†æè°ƒåº¦
â”‚   â””â”€â”€ models.py              # ç›´æ’­ç›¸å…³æ•°æ®æ¨¡å‹
â”œâ”€â”€ api/v1/endpoints/
â”‚   â””â”€â”€ live.py                # æ–°å¢ï¼šç›´æ’­ API ç«¯ç‚¹
```

### 4.3 API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/v1/live/matches` | GET | è·å–æ¯”èµ›åˆ—è¡¨ï¼ˆç›´æ’­+è¿‘æœŸï¼‰ |
| `/api/v1/live/matches/{id}` | GET | è·å–æ¯”èµ›è¯¦æƒ…ï¼ˆå«ç€æ³•ã€åˆ†æï¼‰ |
| `/api/v1/live/matches/{id}/analysis` | GET | è·å–æŒ‡å®šæ‰‹æ•°çš„åˆ†ææ•°æ® |
| `/api/v1/live/upcoming` | GET | è·å–èµ›äº‹é¢„å‘Šåˆ—è¡¨ |
| `/api/v1/live/matches/{id}/comments` | GET | è·å–è¯„è®ºåˆ—è¡¨ |
| `/api/v1/live/matches/{id}/comments` | POST | å‘è¡¨è¯„è®ºï¼ˆéœ€ç™»å½•ï¼‰ |

### 4.4 æ•°æ®æ¨¡å‹

```python
# æ¯”èµ›ä¿¡æ¯
class LiveMatch:
    id: str                    # å†…éƒ¨ID
    source: str                # "xingzhen" | "weiqi_org"
    source_id: str             # åŸå§‹æ•°æ®æºID
    tournament: str            # èµ›äº‹åç§°
    date: datetime             # æ¯”èµ›æ—¥æœŸ
    player_black: str          # é»‘æ–¹æ£‹æ‰‹
    player_white: str          # ç™½æ–¹æ£‹æ‰‹
    status: str                # "live" | "finished"
    result: str | None         # æ¯”èµ›ç»“æœ
    move_count: int            # å½“å‰æ‰‹æ•°
    current_winrate: float     # å½“å‰é»‘æ–¹èƒœç‡
    sgf: str | None            # SGF æ•°æ®

# åˆ†ææ•°æ®
class MoveAnalysis:
    match_id: str
    move_number: int
    winrate: float             # é»‘æ–¹èƒœç‡
    score_lead: float          # é»‘æ–¹é¢†å…ˆç›®æ•°
    top_moves: list            # AI æ¨èç€æ³•
    is_brilliant: bool         # å¦™æ‰‹æ ‡è®°
    is_mistake: bool           # é—®é¢˜æ‰‹æ ‡è®°
    is_questionable: bool      # ç–‘é—®æ‰‹æ ‡è®°
    delta_score: float         # ç›®æ•°å˜åŒ–
    delta_winrate: float       # èƒœç‡å˜åŒ–
```

---

## 5. å‰ç«¯ç»„ä»¶

### 5.1 æ–‡ä»¶ç»“æ„

```
katrain/web/ui/src/galaxy/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ live/
â”‚       â”œâ”€â”€ LivePage.tsx           # ä¸€çº§é¡µé¢ï¼šç›´æ’­é¦–é¡µ
â”‚       â””â”€â”€ LiveMatchPage.tsx      # äºŒçº§é¡µé¢ï¼šå¯¹å±€è¯¦æƒ…
â”œâ”€â”€ components/
â”‚   â””â”€â”€ live/
â”‚       â”œâ”€â”€ MatchCard.tsx          # æ¯”èµ›å¡ç‰‡ï¼ˆåˆ—è¡¨é¡¹ï¼‰
â”‚       â”œâ”€â”€ MatchList.tsx          # æ¯”èµ›åˆ—è¡¨
â”‚       â”œâ”€â”€ UpcomingList.tsx       # èµ›äº‹é¢„å‘Šåˆ—è¡¨
â”‚       â”œâ”€â”€ MatchInfo.tsx          # å¯¹å±€ä¿¡æ¯é¢æ¿
â”‚       â”œâ”€â”€ AiAnalysis.tsx         # AI æ¨èç€æ³•é¢æ¿
â”‚       â”œâ”€â”€ TrendChart.tsx         # èµ°åŠ¿å›¾ï¼ˆå¤ç”¨/æ”¹é€ ç°æœ‰ï¼‰
â”‚       â”œâ”€â”€ BrilliantMoves.tsx     # å¦™æ‰‹åˆ—è¡¨
â”‚       â”œâ”€â”€ MistakeMoves.tsx       # é—®é¢˜æ‰‹åˆ—è¡¨
â”‚       â”œâ”€â”€ LiveControls.tsx       # åŠŸèƒ½æŒ‰é’®ç»„
â”‚       â”œâ”€â”€ CommentSection.tsx     # è¯„è®ºåŒº
â”‚       â”œâ”€â”€ PlaybackBar.tsx        # æ’­æ”¾æ§åˆ¶æ 
â”‚       â””â”€â”€ PvOverlay.tsx          # PV æ¨æ¼”è¦†ç›–å±‚
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ live/
â”‚       â”œâ”€â”€ useLiveMatches.ts      # æ¯”èµ›åˆ—è¡¨æ•°æ® hook
â”‚       â”œâ”€â”€ useLiveMatch.ts        # å•åœºæ¯”èµ›æ•°æ® hook
â”‚       â”œâ”€â”€ useAnalysis.ts         # åˆ†ææ•°æ® hook
â”‚       â””â”€â”€ useComments.ts         # è¯„è®ºæ•°æ® hook
â””â”€â”€ context/
    â””â”€â”€ LiveContext.tsx            # ç›´æ’­çŠ¶æ€ç®¡ç†
```

### 5.2 çŠ¶æ€ç®¡ç†

```typescript
interface LiveState {
  // æ¯”èµ›åˆ—è¡¨
  matches: LiveMatch[];
  upcomingMatches: UpcomingMatch[];

  // å½“å‰æ¯”èµ›
  currentMatch: LiveMatch | null;
  currentMoveNumber: number;
  isLive: boolean;

  // åˆ†ææ•°æ®
  analysisData: Map<number, MoveAnalysis>;

  // PV æ˜¾ç¤º
  hoveredMove: string | null;
  pvMoves: string[];
  pvAnimationIndex: number;

  // è½®è¯¢æ§åˆ¶
  isPolling: boolean;
}
```

---

## 6. é…ç½®ç»“æ„

```json
{
  "live": {
    "sources": {
      "xingzhen": {
        "enabled": true,
        "api_base": "https://api.19x19.com/api/engine/golives",
        "endpoints": {
          "live_list": "/all",
          "history": "/history",
          "situation": "/situation/{live_id}",
          "winrates": "/winrates/{live_id}"
        }
      },
      "weiqi_org": {
        "enabled": true,
        "api_base": "https://wqapi.cwql.org.cn",
        "endpoints": {
          "battle_list": "/playerInfo/battle/list",
          "battle_detail": "/playerInfo/battle/{battle_no}"
        },
        "web_url": "https://www.weiqi.org.cn/competition/battle"
      }
    },
    "polling": {
      "list_interval": 60,
      "moves_interval": 3,
      "analysis_interval": 5
    },
    "analysis": {
      "max_visits": 500,
      "use_local_katago": true
    },
    "display": {
      "pv_moves": 10,
      "pv_anim_time": 0.3,
      "brilliant_threshold": 2.0,
      "mistake_threshold": -3.0,
      "questionable_threshold": -1.5
    }
  }
}
```

---

## 7. å®ç°é˜¶æ®µ

| é˜¶æ®µ | å†…å®¹ | ä¾èµ– |
|------|------|------|
| **Phase 1** | åç«¯ API å®¢æˆ·ç«¯ï¼ˆXingZhen + weiqi.orgï¼‰ | æ—  |
| **Phase 2** | åç«¯è½®è¯¢ + ç¼“å­˜ + API ç«¯ç‚¹ | Phase 1 |
| **Phase 3** | å‰ç«¯ä¸€çº§é¡µé¢ï¼ˆç›´æ’­é¦–é¡µï¼‰ | Phase 2 |
| **Phase 4** | å‰ç«¯äºŒçº§é¡µé¢ï¼ˆå¯¹å±€è¯¦æƒ…ï¼‰ | Phase 3 |
| **Phase 5** | KataGo æœ¬åœ°åˆ†æé›†æˆ | Phase 2 |
| **Phase 6** | PV æ¨æ¼”æ˜¾ç¤º | Phase 4, 5 |
| **Phase 7** | è¯„è®ºç³»ç»Ÿ | Phase 4 |
| **Phase 8** | èµ›äº‹é¢„å‘Šçˆ¬å– | Phase 2 |

---

## 8. åç»­å¾…åŠï¼ˆMVP ä¹‹åï¼‰

- [ ] è¯„è®ºå®¡æ ¸åŠŸèƒ½
- [ ] æ£‹æ‰‹å¤´åƒæ‰¹é‡è·å–
- [ ] æ£‹æ‰‹åå­—ä¸­è‹±ç¿»è¯‘
- [ ] åœä¸€æ‰‹ã€ç ”ç©¶ã€åˆ†äº«åŠŸèƒ½
- [ ] æ£‹å‹èµ›äº‹æ”¯æŒ
- [ ] æ›´å¤šæ•°æ®æºï¼ˆæ—¥æœ¬æ£‹é™¢ã€éŸ©å›½æ£‹é™¢ï¼‰

---

## 9. PV æ¨æ¼”æ˜¾ç¤ºå‚è€ƒ

å‚è€ƒ KaTrain æ¡Œé¢ç‰ˆå®ç° (`katrain/gui/badukpan.py`):

- **æ˜¾ç¤ºæ–¹å¼**: `draw_pv()` æ–¹æ³•ï¼ŒåŠé€æ˜æ£‹å­ + åºå·æ ‡ç­¾
- **è§¦å‘æ–¹å¼**: é¼ æ ‡æ‚¬åœåœ¨æ¨èæ‹›æ³•ä¸Š
- **åŠ¨ç”»é…ç½®**: `general/anim_pv_time` (é»˜è®¤ 0.5 ç§’)
- **æ•°æ®æ¥æº**: KataGo `analysis.json["moveInfos"][0]["pv"]`

---

## 10. å¦™æ‰‹/é—®é¢˜æ‰‹æ ‡æ³¨

| æ ‡æ³¨ç±»å‹ | é˜ˆå€¼ | è¯´æ˜ |
|----------|------|------|
| é—®é¢˜æ‰‹ ğŸ”´ | delta < -3.0 ç›® | æ˜æ˜¾å¤±è¯¯ |
| ç–‘é—®æ‰‹ ğŸŸ¡ | delta < -1.5 ç›® | å°å¤±è¯¯ |
| å¦™æ‰‹ ğŸŸ¢ | delta > +2.0 ç›® | æ‰­è½¬å±€åŠ¿çš„å¥½æ£‹ |

**æ‚¬åœæ˜¾ç¤ºåŸå› **: ç›®æ•°å˜åŒ–ï¼ˆå¦‚ "-5.2ç›®"ï¼‰ã€èƒœç‡å˜åŒ–ï¼ˆå¦‚ "-12.3%"ï¼‰
