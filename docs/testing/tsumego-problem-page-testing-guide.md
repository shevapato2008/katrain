# TsumegoProblemPage 手动测试指南

## 概述

本指南用于测试死活题解题页面 (`/galaxy/tsumego/problem/:problemId`) 的所有功能。

## 前置条件

1. 启动服务器：

   ```bash
   python -m katrain --ui web --host 127.0.0.1 --port 8001
   ```
2. 确保数据库中有死活题数据（可通过 API 验证）：

   ```bash
   curl http://127.0.0.1:8001/api/v1/tsumego/levels
   ```
3. 打开浏览器访问：`http://127.0.0.1:8001/galaxy`

---

## 测试用例

### 1. 页面导航测试

#### 1.1 从题目列表进入

- [X] 导航到 `死活题` > 选择级别 > 选择分类 > 点击任意题目卡片
- [X] 验证页面跳转到 `/galaxy/tsumego/problem/{problemId}`
- [X] 验证面包屑显示正确：`死活题 / {级别} / {分类} / 第N题`

#### 1.2 直接访问 URL

- [X] 直接访问 `http://127.0.0.1:8001/galaxy/tsumego/problem/1014`
- [X] 验证页面正常加载，无报错

#### 1.3 返回导航

- [X] 点击左上角返回箭头
- [X] 验证返回到对应分类的题目列表页

#### 1.4 面包屑导航

- [X] 点击面包屑中的 `死活题` → 返回级别选择页
- [X] 点击面包屑中的级别（如 `3D`）→ 返回分类选择页
- [X] 点击面包屑中的分类（如 `死活`）→ 返回题目列表页

---

### 2. 棋盘渲染测试

#### 2.1 基础渲染

- [X] 棋盘背景图片正确加载
- [X] 网格线清晰可见
- [X] 星位点正确显示（9路/13路/19路）
- [X] 坐标标签正确显示（A-T, 1-19）

#### 2.2 棋子渲染

- [X] 初始黑棋正确显示在题目位置
- [X] 初始白棋正确显示在题目位置
- [X] 棋子图片正确加载（非纯色圆形）

#### 2.3 响应式布局

- [X] 桌面端：棋盘和控制面板左右并排
- [X] 移动端（窄屏）：棋盘在上，控制面板在下
- [X] 调整窗口大小时棋盘自适应缩放

---

### 3. 控制面板测试

#### 3.1 题目信息显示

- [X] 级别标签正确显示（如 `3D`）
- [X] 分类标签正确显示（如 `死活`）
- [X] 当前执棋方显示正确（黑先/白先）

#### 3.2 计时器

- [X] 页面加载后计时器开始运行
- [X] 格式显示为 `mm:ss`
- [X] 解题成功后计时器停止
- [X] 重置后计时器归零并重新开始

#### 3.3 尝试次数

- [X] 初始不显示尝试次数（或显示为 0）
- [X] 每次错误尝试后次数 +1
- [X] 重置后尝试次数归零

---

### 4. 落子交互测试

#### 4.1 基础落子

- [ ] 点击棋盘空位可以落子
- [ ] 点击已有棋子的位置无反应
- [ ] 点击棋盘外区域无反应

#### 4.2 正确落子

- [ ] 落在正确位置后，棋子显示在棋盘上
- [ ] 最后落子有圆圈标记
- [ ] AI 自动应对（白棋响应）
- [ ] 执棋方指示器切换

#### 4.3 错误落子

- [ ] 落在错误位置后，显示错误提示 Snackbar
- [ ] Snackbar 显示 "This move is not correct. Try again!" 或对应翻译
- [ ] 状态显示为"错误"
- [ ] 尝试次数增加

#### 4.4 解题成功

- [ ] 完成所有正确步骤后，显示成功状态
- [ ] 状态区域显示绿色勾号和"正确"
- [ ] 成功 Snackbar 提示
- [ ] 棋盘禁用（无法继续落子）
- [ ] "下一题"按钮高亮显示

---

### 5. 提示功能测试

#### 5.1 显示提示

- [ ] 点击"显示提示"按钮
- [ ] 棋盘上显示绿色半透明圆圈标记正确位置
- [ ] 按钮文字变为"隐藏提示"
- [ ] 提示文本显示（如有）

#### 5.2 隐藏提示

- [ ] 点击"隐藏提示"按钮
- [ ] 绿色提示圆圈消失
- [ ] 按钮文字恢复为"显示提示"

#### 5.3 提示跟随进度

- [ ] 落子正确后，提示位置更新为下一步正确位置
- [ ] 解题完成后提示功能禁用或无效果

---

### 6. 撤销/重置功能测试

#### 6.1 撤销功能

- [ ] 初始状态撤销按钮禁用
- [ ] 落子后撤销按钮启用
- [ ] 点击撤销后，最后一手棋消失
- [ ] AI 的应对也一并撤销
- [ ] 执棋方指示器恢复
- [ ] 可连续撤销多步
- [ ] 解题成功后撤销按钮禁用

#### 6.2 重置功能

- [ ] 点击重置按钮
- [ ] 棋盘恢复到初始状态
- [ ] 计时器归零并重新开始
- [ ] 尝试次数归零
- [ ] 状态恢复为正常（非成功/失败）
- [ ] 撤销按钮禁用

---

### 7. 题目导航测试

#### 7.1 上一题/下一题

- [X] 第一题时"上一题"按钮禁用
- [X] 最后一题时"下一题"按钮禁用
- [X] 点击"下一题"加载下一道题目
- [X] 点击"上一题"加载上一道题目
- [X] 导航后 URL 更新为新的 problemId

#### 7.2 解题后导航

- [ ] 解题成功后"下一题"按钮变为绿色高亮
- [ ] 点击后正常跳转到下一题

---

### 8. 国际化测试

#### 8.1 中文界面

- [ ] 设置语言为简体中文
- [ ] 验证以下文本正确显示：
  - 黑先 / 白先
  - 正确 / 错误
  - 显示提示 / 隐藏提示
  - 撤销 / 重置
  - 上一题 / 下一题
  - 尝试次数
  - 死活题加载失败（错误状态）

#### 8.2 英文界面

- [ ] 设置语言为英文
- [ ] 验证以下文本正确显示：
  - Black to play / White to play
  - Solved / Incorrect
  - Show Hint / Hide Hint
  - Undo / Reset
  - Previous / Next
  - Attempts

#### 8.3 其他语言

- [ ] 测试日文 (jp)、韩文 (ko)、德文 (de) 等语言切换
- [ ] 验证界面文本正确切换，无缺失

---

### 9. 错误处理测试

#### 9.1 无效题目 ID

- [ ] 访问 `/galaxy/tsumego/problem/invalid-id`
- [ ] 显示错误提示"Problem not found"或加载失败信息

#### 9.2 网络错误

- [ ] 断开网络后刷新页面
- [ ] 显示适当的错误提示

#### 9.3 API 错误

- [ ] 模拟 API 返回 500 错误
- [ ] 页面显示错误状态而非崩溃

---

### 10. 性能测试

#### 10.1 加载性能

- [ ] 页面首次加载时间 < 3秒
- [ ] 棋盘渲染无明显卡顿

#### 10.2 交互性能

- [ ] 落子响应时间 < 100ms
- [ ] 撤销/重置操作无延迟
- [ ] 提示显示/隐藏流畅

---

## 测试数据

### 推荐测试题目

| 题目 ID | 级别 | 分类 | 特点       |
| ------- | ---- | ---- | ---------- |
| 1014    | 3D   | 死活 | 多分支变化 |
| 1015    | 3D   | 死活 | 标准死活   |

### 获取更多测试题目

```bash
# 获取 3D 级别死活题列表
curl "http://127.0.0.1:8001/api/v1/tsumego/levels/3d/categories/life-death?limit=10"

# 获取单个题目详情
curl "http://127.0.0.1:8001/api/v1/tsumego/problems/1014"
```

---

## 已知限制

1. **提示文本**：hint 字段来自原始数据，通常只是"黑先"等简单提示
2. **进度保存**：当前版本暂未实现进度持久化到服务器
3. **键盘快捷键**：暂未实现（计划：Z=撤销, H=提示, N=下一题）

---

## Bug 报告模板

如发现问题，请记录以下信息：

```
**环境**
- 浏览器：
- 操作系统：
- 屏幕尺寸：

**复现步骤**
1.
2.
3.

**预期结果**


**实际结果**


**截图/录屏**

```

---

## 更新日志

- **2025-01-22**: 初始版本，完成 TsumegoProblemPage 基础功能测试指南
