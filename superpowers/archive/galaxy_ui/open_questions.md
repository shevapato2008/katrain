# Galaxy Go UI - 待确认产品需求

> 日期: 2026-01-20
> 状态: ✅ **全部已确认**
> 决策记录: [confirmed_requirements.md](./confirmed_requirements.md)

基于对星阵围棋模块介绍文档的深入分析，以下产品需求已全部确认。

---

## 1. AI级别体系 ✅ RESOLVED

### 问题描述
星阵围棋有31个水平均匀分布的AI棋手（从入门到绝顶高手），使用独特技术让AI下法更像人类。

### 决策
- **使用 Human-like AI (20k - 9D)** 进行定级和升降对局
- 该AI拥有完善的级别体系，适合作为标准参考
- 其他AI策略（如Ky/Dan等）作为娱乐模式保留

### 实现状态
- ✅ 决策已确认
- ✅ 后端ranking系统已实现 (`katrain/web/core/ranking.py`)
- 🔄 前端段位标签工具开发中

---

## 2. 道具系统 ✅ RESOLVED

### 问题描述
星阵围棋提供三种道具：
- **领地道具**：显示当前局面形势判断和每个交叉点归属
- **支招道具**：获得AI选点推荐
- **变化图道具**：查看AI想象的后续进程

### 决策
- **不限制使用次数**
- 复用KaTrain现有功能：
  - 形势分析（Ownership显示）= 领地道具
  - AI建议（Analysis Panel显示top moves）= 支招道具
  - 变化图显示 = 变化图道具
- UI上可以按照星阵风格分类展示，但不做扣费或次数限制逻辑

### 实现状态
- ✅ 决策已确认
- ✅ 无需额外开发，现有功能满足需求

---

## 3. 计费系统 ✅ RESOLVED

### 问题描述
星阵围棋是付费服务：
- 研究功能按分钟计费
- 有星币余额系统
- 不同配置(5X-200X)对应不同费率

### 决策
- **预留Credits系统，暂不收费**
- UI显示积分余额
- 初始给用户无限或大额Credits (10000)
- 后端需基于PostgreSQL设计

### 实现状态
- ✅ 决策已确认
- ✅ 数据库schema已实现 (`users.credits` 字段)
- ✅ 初始Credits: 10000.00

---

## 4. 好友/社交系统 ✅ RESOLVED

### 问题描述
星阵围棋有完整的社交功能：
- 在线棋友列表（全部/同级别/已关注）
- 关注/取消关注
- 邀请状态设置（允许/拒绝邀请）
- 查看棋友个人信息和历史棋谱

### 决策
- **完整版 (Cloud SGF + 社交)**
- Cloud SGF: 用户可保存棋谱到云端（数据库）
- Social: 好友列表、关注功能

### 实现状态
- ✅ 决策已确认
- ✅ 数据库schema已实现 (`relationships` 表)
- ✅ Cloud SGF功能已实现 (P3)
- ⬜ 好友列表UI待P5实现

---

## 5. 棋谱库 ✅ RESOLVED

### 问题描述
星阵围棋有：
- 我的棋谱（用户历史对局）
- 公共棋谱（名局、大赛、AI自对弈）
- 从棋谱库选择棋谱进行分析

### 决策
- **完整版: Cloud SGF + 社交**
- 用户历史对局保存到云端
- 通过`games`表记录对局和SGF内容

### 实现状态
- ✅ 决策已确认
- ✅ 数据库schema已实现 (`games.sgf_content` 字段)
- ✅ CloudSGFPanel组件已实现 (P3)
- ✅ "My Games" 功能已实现

---

## 6. 对局类型 ✅ RESOLVED

### 问题描述
星阵围棋区分：
- **自由战**：不计成绩，可自定义规则和用时
- **升降战**：计入成绩，用于升降级

### 决策
- **区分 Free (自由对局) 和 Rated (升降对局)**
- Rated: 结果影响用户段位，用于定级，影响人人对弈匹配
- Free: 娱乐性质，不计分
- UI需在对弈菜单中明确区分入口或选项

### 实现状态
- ✅ 决策已确认
- ✅ 数据库schema已实现 (`games.game_type` 字段: 'free' / 'rated')
- ✅ PlayMenu页面已实现区分入口

---

## 7. 对局结束后流程 ✅ RESOLVED

### 问题描述
星阵围棋对局结束后提供：
- 一键生成棋谱报告
- 跳转到研究模式深度分析
- AI数子判定胜负

### 决策
- 复用KaTrain现有GameReportDialog
- 提供跳转到研究模式选项
- AI评分已有，数子功能可选

### 实现状态
- ✅ 决策已确认
- 🔄 P4实现中（对局结束流程）

---

## 8. 快捷键支持 ✅ RESOLVED

### 问题描述
星阵围棋有丰富的快捷键：
- 空格/回车：落子AI首选
- 数字键1-9：查看第N选点变化图
- 方向键：棋谱导航
- PgUp/PgDn：快进5手
- Home/End：跳转首末
- Esc：取消变化图锁定

### 决策
- **保持KaTrain默认快捷键**
- 暂不对齐星阵快捷键
- 后续视需求调整

### 实现状态
- ✅ 决策已确认
- ✅ 现有useKeyboardShortcuts hook继续使用

---

## 决策总结

| 问题 | 决策 | 状态 |
|------|------|------|
| #1 AI级别体系 | Human-like AI (20k-9D) | ✅ |
| #2 道具系统 | 不限制使用次数 | ✅ |
| #3 计费系统 | Credits预留但暂不收费 | ✅ |
| #4 好友系统 | 完整版 | ✅ |
| #5 棋谱库 | Cloud SGF + 社交 | ✅ |
| #6 对局类型 | Free vs Rated | ✅ |
| #7 结束流程 | 复用现有 | ✅ |
| #8 快捷键 | 保持KaTrain默认 | ✅ |

---

## 下一步行动

所有产品决策已确认，详见 [confirmed_requirements.md](./confirmed_requirements.md)。

当前进度:
- P1-P3: ✅ 已完成
- P4: 🔄 进行中
- P5-P6: ⬜ 待开发
