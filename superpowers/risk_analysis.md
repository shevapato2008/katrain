# Galaxy Go UI - 风险分析

> 日期: 2026-01-20
> 更新: 同步自实际开发进度

## 风险状态总览

| 风险ID | 描述 | 原始等级 | 当前状态 |
|--------|------|----------|----------|
| #1 | 人人对弈后端复杂度 | 高 | ⬜ 待评估 (P5) |
| #2 | 路由状态管理 | 高 | ✅ 已缓解 |
| #3 | 现有App.tsx耦合度 | 高 | ✅ 已缓解 |
| #4 | AI级别体系不一致 | 中 | ✅ 已解决 |
| #5 | 观战WebSocket广播 | 中 | ⬜ 待评估 (P5) |
| #6 | AI定级算法准确性 | 中 | ✅ 已解决 |
| #7 | 移动端适配 | 中 | ⬜ P6处理 |
| #8 | 道具系统重叠 | 低-中 | ✅ 已解决 |
| #9 | 对局类型区分复杂度 | 中 | ✅ 已解决 |
| #10 | i18n翻译覆盖 | 低 | ⬜ P6处理 |
| #11 | 设计风格偏差 | 低 | ✅ 已缓解 |
| #12 | 快捷键冲突 | 低 | ✅ 已解决 |

---

## 已缓解风险 (✅)

### #2 路由状态管理 - 已缓解

**原风险**: 从对弈页面切换到其他页面时，游戏状态可能丢失

**实际解决方案**:
- ✅ React Router v6 成功安装并配置
- ✅ `useGameSession.ts` hook 管理游戏状态
- ✅ 路由隔离正常工作 (`/` vs `/galaxy/*`)
- ✅ 状态通过Context持久化

**验证**: P1-P3阶段验证通过

---

### #3 现有App.tsx耦合度 - 已缓解

**原风险**: 难以分离出独立的Galaxy UI

**实际解决方案**:
- ✅ 两套UI并存，通过路由隔离
- ✅ Galaxy UI完全独立于原有App.tsx
- ✅ 共享组件 (Board, AnalysisPanel等) 正常复用
- ✅ MUI Theme成功提取到 `src/theme.ts`

**验证**: P1阶段验证通过，两套UI独立运行

---

### #4 AI级别体系不一致 - 已解决

**原风险**: 星阵31级AI与KaTrain策略体系不一致

**产品决策** (见 confirmed_requirements.md):
- 使用 **Human-like AI (20k-9D)** 用于定级和升降对局
- 其他AI策略作为娱乐模式保留
- 段位映射工具开发中

**状态**: 已确认，P4实现中

---

### #6 AI定级算法准确性 - 已解决

**原风险**: 3盘定级可能不够准确

**实际解决方案**:
- ✅ `katrain/web/core/ranking.py` 实现排名系统
- ✅ 数据库设计支持 `rating_history` 表记录变动
- ✅ ELO积分系统 + 段位系统双轨制

**验证**: P4后端已实现

---

### #8 道具系统与现有功能重叠 - 已解决

**原风险**: 星阵"道具"概念与KaTrain已有功能重叠

**产品决策**:
- **不限制使用次数**
- 复用现有功能 (Ownership、Top Moves、变化图)
- UI上可按星阵风格分类展示

**状态**: 已确认，无需额外开发

---

### #9 对局类型区分复杂度 - 已解决

**原风险**: 自由战/升降战的区分增加复杂度

**实际解决方案**:
- ✅ 数据库 `games.game_type` 字段支持 `'free'` / `'rated'`
- ✅ 后端API支持对局类型标记
- ✅ UI明确区分入口

**验证**: 数据库schema已实现 (`katrain/postgres/init.sql`)

---

### #11 设计风格偏差 - 已缓解

**原风险**: 新组件与Zen Mode风格不一致

**实际解决方案**:
- ✅ 所有Galaxy UI组件使用提取的MUI主题
- ✅ 组件复用确保视觉一致性
- ✅ GalaxySidebar、Dashboard等遵循Zen Mode美学

**验证**: P2阶段UI审查通过

---

### #12 快捷键冲突 - 已解决

**原风险**: 快捷键可能与浏览器或KaTrain冲突

**产品决策**:
- **保持KaTrain默认快捷键**
- 暂不对齐星阵快捷键

**状态**: 已确认，无需修改

---

## 待评估风险 (P5阶段)

### #1 人人对弈后端复杂度

**风险等级**: 高
**影响阶段**: P5

**当前状态**:
- 数据库schema已就绪 (`games`, `relationships` 表)
- 前端UI框架已建立
- 后端WebSocket支持待开发

**待评估项**:
- [ ] 匹配算法设计
- [ ] WebSocket房间管理
- [ ] 观战广播机制
- [ ] 实时对弈同步

**缓解措施** (计划):
- 前端先用Mock数据完成UI
- 后端API设计文档先行
- 考虑使用现有WebSocket扩展

---

### #5 观战WebSocket广播

**风险等级**: 中
**影响阶段**: P5

**当前状态**:
- 产品决策确认P5实现观战功能
- 技术方案待确定

**待评估项**:
- [ ] 房间模式WebSocket设计
- [ ] 观众人数上限
- [ ] 带宽和性能影响

---

## 已解决的依赖项

| 依赖 | 所需阶段 | 状态 |
|------|----------|------|
| React Router v6 | P1 | ✅ 已安装 |
| 现有认证API | P2 | ✅ 已集成 |
| 现有Board组件 | P3-P5 | ✅ 正常复用 |
| PostgreSQL设置 | P1.5 | ✅ 已完成 |
| MUI Theme提取 | P1 | ✅ 已完成 |
| AuthContext | P2 | ✅ 已实现 |
| AuthGuard | P3 | ✅ 已实现 |
| Cloud SGF API | P3 | ✅ 已实现 |
| Ranking System | P4 | ✅ 已实现 |

## 待解决依赖项

| 依赖 | 所需阶段 | 状态 | 阻塞程度 |
|------|----------|------|----------|
| 人人对弈API | P5 | 需开发 | 阻塞P5 |
| WebSocket房间支持 | P5 | 需开发 | 阻塞P5观战 |
| i18n新文本 | P6 | 待收集 | 非阻塞 |

---

## 已验证的阶段性检查点

### P1验证点 ✅ ALL PASS
- [x] 两套UI路由隔离正常
- [x] 共享状态（token、session）可跨UI访问
- [x] 新组件风格与现有一致
- [x] MUI主题成功提取为独立文件

### P2验证点 ✅ ALL PASS
- [x] 登录状态在Galaxy UI中正常
- [x] 侧边栏导航功能完整
- [x] AuthGuard正确拦截未登录用户
- [x] Credits/Rank显示正常

### P3验证点 ✅ ALL PASS
- [x] 研究模式正确要求登录
- [x] 现有Board组件在新布局中正常工作
- [x] Cloud SGF加载/保存功能正常

### P4验证点 🔄 IN PROGRESS (4 Bugs待修)

**已完成**:
- [x] Backend ranking系统完成
- [x] AiSetupPage基础UI
- [x] GamePage基础UI
- [x] ITEMS面板 (Territory/Advice/Graph/Policy)

**待修复Bug**:
- [ ] Bug #1: 添加Rules选择器 (Japanese/Chinese/Korean/AGA等)
- [ ] Bug #2: Handicap让子初始化 (设置后棋盘无让子石)
- [ ] Bug #3: Timer显示重构 (Main Time + Byo-yomi + Periods)
- [ ] Bug #4: AI段位显示 (`-19` → `20k`, `9` → `9d`)

**验收标准**:
- [ ] 人机对弈全流程正常
- [ ] 对局可以正常结束
- [ ] Timer UI正确显示三个时间组件

### P5验证点 ⬜ NOT STARTED
- [ ] Mock数据驱动的大厅UI
- [ ] 真实匹配流程
- [ ] 观战功能
- [ ] WebSocket广播正常

---

## 回退方案

如果Galaxy UI开发遇到严重阻塞：

1. **P1-P2阻塞**: ✅ 已完成，无需回退
2. **P3阻塞**: ✅ 已完成，无需回退
3. **P4阻塞**: 人机对弈可复用现有Zen Mode流程
4. **P5阻塞**: 人人对弈推迟到下一版本，先上线P1-P4

**底线**: 即使P5未完成，P1-P4已经提供了完整的单人体验。

---

## 风险变更日志

| 日期 | 变更 |
|------|------|
| 2026-01-20 | 初始风险分析 |
| 2026-01-20 | 更新: P1-P3完成，多项风险已缓解 |
| 2026-01-20 | 同步: 与conductor/tracks/galaxy_ui_20260119/plan.md对齐 |
