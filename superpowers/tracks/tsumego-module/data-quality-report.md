# 死活题 SGF 数据质量报告

> 生成时间: 2026-01-22
> 数据来源: data/life-n-death/ (3D: 354题, 4D: 642题, 共996题)

---

## 概述

当前数据存在以下主要问题：

| 问题类型 | 影响数量 | 严重程度 | 可自动修复 |
|----------|----------|----------|------------|
| 缺少标准正确标记 | 879 题 (88%) | 🔴 高 | 部分可推断 |
| 叶子节点注释模糊 | 647 处 | 🔴 高 | 需KataGo验证 |
| 题型分类不全 | 42 题 | 🟡 中 | 可扩展解析 |
| 变化树过浅 | 1 题 | 🟢 低 | 需人工检查 |

---

## 问题1：缺少标准正确标记 (879题, 88%)

### 描述

只有 **76题 (7.6%)** 使用标准的 `C[恭喜答对]` 标记正确路径。其余题目使用各种非标准描述。

### 现有标记模式统计

| 模式 | 数量 | 示例 | 可解析性 |
|------|------|------|----------|
| `恭喜/答对` | 76 | `C[恭喜答对]` | ✅ 标准 |
| `正确` | 4 | `C[白2正确]` | ✅ 可解析 |
| `X活` (黑活/白活/净活/淨活) | 350 | `C[黑活。]` `C[黑淨活]` | ✅ 可解析 |
| `X死` (黑死/白死) | 36 | `C[白死]` `C[这样白死]` | ✅ 可解析 |
| `X杀` (眼杀/净杀) | 11 | `C[白棋反遭净杀]` | ✅ 可解析 |
| `劫` | 237 | `C[打劫]` `C[连环劫]` | ⚠️ 需判断谁有利 |
| `失败/重来` | 284 | `C[失败]` `C[失败，重来吧]` | ✅ 可解析 |
| `错误` | 5 | `C[白2应对错误]` | ✅ 可解析 |
| `不行/不成` | 18 | `C[黑不行。]` | ✅ 可解析 |
| `0分` | 若干 | `C[失败（0 分）]` | ✅ 可解析 |
| **其他/模糊** | **647** | 各种描述性文字 | ❌ 无法自动解析 |

### 模糊注释具体示例

以下叶子节点注释无法自动判断正误：

| 题号 | 注释内容 | 问题 |
|------|----------|------|
| 3D/1014 | `此题有毒` | 无法判断是正确还是特殊情况 |
| 3D/1041 | `黑已死` | "黑已死"是正确(杀死对方)还是失败(己方死)？取决于题目要求 |
| 3D/1041 | `一路都是黑棋必应的地方，貌似顺序可以有些变化，关键是第一手。` | 纯解说，无结果判定 |
| 3D/14812 | `黑不行。` | 需要结合PL属性判断：如果黑先，则失败；如果白先，则可能是正确 |
| 3D/18485 | `8 图 (; 不能接 ) 以后，黑6打，白7接...` | 长解说，无明确结果 |
| 4D/1004 | `连环劫，白棋净死` | 劫+结果，需要解析组合 |

### 建议优化

**爬虫端：**
1. 强制在每个叶子节点添加标准标记：
   - 正确路径：`C[✓ 正确]` 或 `C[恭喜答对]`
   - 错误路径：`C[✗ 失败]` 或 `C[失败，重来吧]`
   - 打劫：`C[⚡ 打劫-黑优]` / `C[⚡ 打劫-白优]` / `C[⚡ 打劫-两分]`

2. 如果原网站有明确的正误判定UI，直接从API/DOM中提取结果，而非依赖注释文本

**后处理：**
1. 使用KataGo离线分析所有模糊叶子节点
2. 根据PL属性和最终局面判断胜负

---

## 问题2：题型分类不完整 (42题)

### 描述

当前解析只识别 `死活题`、`手筋题`、`官子题`。但数据中存在其他题型：

### 具体示例

| 题号 | GC内容 | 实际题型 |
|------|--------|----------|
| 3D/122126 | `对杀题 \| 3D \| 正确率: 39.3%` | 对杀题 |
| 3D/1585 | `对杀题 \| 3D+ \| 正确率: 23.3%` | 对杀题 |
| 3D/229836 | `布局题 \| 3D \| 正确率: 14.7%` | 布局题 |
| 3D/230022 | `布局题 \| 3D \| 正确率: 21.5%` | 布局题 |
| 4D/234765 | `定式题 \| 4D \| 正确率: ...` | 定式题 |

### 建议

扩展题型识别列表：
```python
CATEGORY_MAP = {
    '死活': 'life-death',
    '手筋': 'tesuji',
    '官子': 'endgame',
    '对杀': 'capturing-race',  # 新增
    '布局': 'opening',          # 新增
    '定式': 'joseki',           # 新增
}
```

---

## 问题3：变化树结构问题 (1题)

### 描述

有1题的变化树深度只有1层，可能是数据不完整。

### 具体示例

| 题号 | 问题 |
|------|------|
| 3D/231434 | max_depth=1，只有一层变化，可能缺少后续手顺 |

### 建议

人工检查此题，或从原网站重新爬取。

---

## 问题4：PL属性与注释不一致

### 描述

部分题目的PL属性与C注释中的"黑先/白先"不一致，或PL属性缺失。

### 建议

爬虫端确保：
1. 始终设置 `PL[B]` 或 `PL[W]`
2. `C` 属性中的提示与 `PL` 一致

---

## 问题5：打劫题的判定复杂性 (237处)

### 描述

237个叶子节点涉及打劫。打劫有多种类型：
- 本身劫（无条件劫）
- 紧气劫（有条件劫）
- 连环劫
- 万年劫
- 摇橹劫

### 具体示例

| 题号 | 注释 | 需要信息 |
|------|------|----------|
| 3D/1044 | `打劫` | 谁发起劫？劫材情况？ |
| 3D/115878 | `连环劫` | 连环劫通常判和棋或按实际情况 |
| 4D/1004 | `连环劫，白棋净死` | 有明确结果，可解析 |

### 建议

1. 爬虫端标准化打劫标记：
   - `C[打劫-黑有利]`：黑方本身劫或劫材多
   - `C[打劫-白有利]`：白方本身劫或劫材多
   - `C[打劫-两分]`：双方均势
   - `C[连环劫-和棋]`：连环劫判和

2. 或使用KataGo评估打劫局面的胜率

---

## 数据修复优先级

| 优先级 | 修复项 | 方法 | 预期效果 |
|--------|--------|------|----------|
| P0 | 标准化叶子节点标记 | 爬虫改进 | 解决88%题目的判定问题 |
| P1 | 扩展题型识别 | 代码修改 | 覆盖42题新类型 |
| P2 | KataGo验证模糊注释 | 离线处理 | 解决647处模糊判定 |
| P3 | 检查浅变化树 | 人工 | 修复1题 |

---

## 附录：需要KataGo验证的题目列表

以下题目的叶子节点存在模糊注释，建议使用KataGo进行验证：

```
3D/1014, 3D/1041, 3D/105073, 3D/106783, 3D/109038, 3D/109060,
3D/111362, 3D/113410, 3D/115781, 3D/120096, 3D/122128, 3D/124628,
... (完整列表约647个)
```

可运行以下命令获取完整列表：
```bash
python scripts/analyze_sgf_quality.py --list-ambiguous
```

---

## 附录：建议的SGF标准格式

```sgf
(;GM[1]FF[4]CA[UTF-8]SZ[19]
GN[Q-1014]
GC[死活题 | 3D | 正确率: 31.9%]
C[黑先]
AB[pa][rd][pb]
AW[nc][qf][oa]
PL[B]

;正确路径
(;B[qd]C[好手]
  (;W[rc]
    (;B[sb]C[✓ 正确 - 黑活])))

;错误路径
(;B[ka]C[缓手]
  (;W[mb]C[✗ 失败 - 白先手活]))

;打劫路径
(;B[na]
  (;W[oa]C[⚡ 打劫 - 黑有利]))
)
```
